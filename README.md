# understanding_django





# Django MVC/MVT Architecture & Multi-App Structure Guide

## Table of Contents
1. [MVC vs MVT Pattern](#mvc-vs-mvt-pattern)
2. [Views as Controllers in Django](#views-as-controllers-in-django)
3. [Complete Request Flow](#complete-request-flow)
4. [Multi-App Architecture](#multi-app-architecture)
5. [API Versioning Strategy](#api-versioning-strategy)
6. [Decision Heuristics](#decision-heuristics)

---

## üèóÔ∏è MVC vs MVT Pattern

### Traditional MVC (Node.js/Express)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           MVC PATTERN (Node.js)         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                         ‚îÇ
‚îÇ  Model ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Controller ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ View ‚îÇ
‚îÇ  (Data)       (Logic)          (UI)    ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  Prisma       Express          React   ‚îÇ
‚îÇ  Schema       Routes           JSX     ‚îÇ
‚îÇ               Services                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Django MVT Pattern

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        MVT PATTERN (Django)              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                          ‚îÇ
‚îÇ  Model ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ View ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Template    ‚îÇ
‚îÇ  (Data)       (Logic)       (UI)        ‚îÇ
‚îÇ                                          ‚îÇ
‚îÇ  Django       Django        HTML/Django ‚îÇ
‚îÇ  ORM          Views         Templates   ‚îÇ
‚îÇ               (Serializers)             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Django REST Framework (API-Only)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    Django REST Framework (API)           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                          ‚îÇ
‚îÇ  Model ‚îÄ‚îÄ‚ñ∫ Serializer ‚îÄ‚îÄ‚ñ∫ View ‚îÄ‚îÄ‚ñ∫ JSON ‚îÇ
‚îÇ  (Data)    (DTO)         (Logic)  (API) ‚îÇ
‚îÇ                                          ‚îÇ
‚îÇ  ORM       Validate      ViewSet   DRF  ‚îÇ
‚îÇ            Transform     Router    Auto ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä Component Comparison

| Component | Node.js/Express | Django REST Framework |
|-----------|-----------------|----------------------|
| **Model** | Prisma Schema | Django Model |
| **Controller** | Route Handler + Service | **View/ViewSet** ‚Üê This is the controller! |
| **DTO** | Custom DTO classes | **Serializer** |
| **View** | React Component | (Handled by React separately) |
| **Router** | Express Router | DRF Router + urls.py |

---

## üéØ Views = Controllers in Django

In Django REST Framework, **Views ARE the Controllers!**

### Node.js/Express Controller Pattern

```javascript
// ============================================
//           NODE.JS / EXPRESS
// ============================================

// 1. MODEL (Prisma Schema)
model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  isActive  Boolean  @default(true)
  posts     Post[]   // One-to-many
}

// 2. DTO (Data Transfer Object)
class UserDTO {
  id: number;
  name: string;
  email: string;
  isActive: boolean;
}

// 3. DAL (Data Access Layer)
class UserRepository {
  async findAll() {
    return await prisma.user.findMany();
  }
  
  async findById(id: number) {
    return await prisma.user.findUnique({ where: { id } });
  }
  
  async create(data: CreateUserDTO) {
    return await prisma.user.create({ data });
  }
}

// 4. SERVICE (Business Logic)
class UserService {
  constructor(private repo: UserRepository) {}
  
  async getUsers() {
    const users = await this.repo.findAll();
    return users.map(u => new UserDTO(u));
  }
  
  async getUser(id: number) {
    const user = await this.repo.findById(id);
    if (!user) throw new Error('Not found');
    return new UserDTO(user);
  }
}

// 5. CONTROLLER (HTTP Layer)
class UserController {
  constructor(private service: UserService) {}
  
  async listUsers(req: Request, res: Response) {
    try {
      const users = await this.service.getUsers();
      res.json(users);
    } catch (error) {
      res.status(500).json({ error: error.message });
    }
  }
  
  async getUser(req: Request, res: Response) {
    try {
      const id = parseInt(req.params.id);
      const user = await this.service.getUser(id);
      res.json(user);
    } catch (error) {
      res.status(404).json({ error: 'Not found' });
    }
  }
  
  async createUser(req: Request, res: Response) {
    try {
      const user = await this.service.createUser(req.body);
      res.status(201).json(user);
    } catch (error) {
      res.status(400).json({ error: error.message });
    }
  }
}

// 6. ROUTER
const userController = new UserController(userService);
router.get('/users', userController.listUsers);
router.get('/users/:id', userController.getUser);
router.post('/users', userController.createUser);
```

### Django REST Framework ViewSet Pattern

```python
# ============================================
#       DJANGO REST FRAMEWORK
# ============================================

# 1. MODEL (Django ORM) - Like Prisma Schema
class User(models.Model):
    name = models.CharField(max_length=100)
    email = models.EmailField(unique=True)
    is_active = models.BooleanField(default=True)
    created_at = models.DateTimeField(auto_now_add=True)
    # posts relationship via ForeignKey in Post model
    
    class Meta:
        db_table = 'users'
        ordering = ['-created_at']

# 2. SERIALIZER (DTO + Validation) - Like DTO
class UserSerializer(serializers.ModelSerializer):
    class Meta:
        model = User
        fields = ['id', 'name', 'email', 'is_active', 'created_at']
        read_only_fields = ['id', 'created_at']

# 3. VIEW (Controller + Service + DAL combined!)
class UserViewSet(viewsets.ModelViewSet):
    """
    This ONE class replaces:
    - Repository (DAL)
    - Service (Business Logic)  
    - Controller (HTTP Handlers)
    - Router (URL patterns)
    
    All CRUD operations automatically generated!
    """
    queryset = User.objects.all()  # ‚Üê DAL: Database query
    serializer_class = UserSerializer  # ‚Üê DTO: Data transformation
    
    # DRF automatically provides these methods:
    # - list(request)      ‚Üí GET /users/
    # - retrieve(request, pk) ‚Üí GET /users/{id}/
    # - create(request)    ‚Üí POST /users/
    # - update(request, pk) ‚Üí PUT /users/{id}/
    # - partial_update(request, pk) ‚Üí PATCH /users/{id}/
    # - destroy(request, pk) ‚Üí DELETE /users/{id}/
    
    # Custom action (like custom controller method)
    @action(detail=True, methods=['get'])
    def posts(self, request, pk=None):
        """GET /api/users/{id}/posts/"""
        user = self.get_object()  # ‚Üê Get user by ID
        posts = user.posts.all()   # ‚Üê Query related posts
        serializer = PostSerializer(posts, many=True)
        return Response(serializer.data)

# 4. ROUTER (Auto-generates URL patterns)
from rest_framework.routers import DefaultRouter

router = DefaultRouter()
router.register(r'users', UserViewSet)
# Auto-creates all CRUD routes!
```

---

## üîÑ Complete Request Flow

### Scenario: GET all users

```
CLIENT REQUEST:
GET http://127.0.0.1:8000/api/users/
```

#### 1Ô∏è‚É£ URL Routing

```python
# blogproject/urls.py (Main Router)
urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/', include('api.urls')),  # Routes to api app
]

# api/urls.py (DRF Router)
router = DefaultRouter()
router.register(r'users', UserViewSet, basename='user')
urlpatterns = [
    path('', include(router.urls)),
]
```

#### 2Ô∏è‚É£ View/Controller

```python
# api/views.py
class UserViewSet(viewsets.ModelViewSet):
    queryset = User.objects.all()  # ‚Üê DATABASE QUERY (DAL)
    serializer_class = UserSerializer  # ‚Üê DATA TRANSFORMATION (DTO)
    
    # DRF calls this method automatically:
    def list(self, request):  # ‚Üê CONTROLLER METHOD
        queryset = self.get_queryset()  # Get all users from DB
        serializer = self.get_serializer(queryset, many=True)  # Serialize
        return Response(serializer.data)  # Return JSON response
```

#### 3Ô∏è‚É£ Model (Database Query)

```python
# User.objects.all() translates to:
SELECT * FROM users ORDER BY created_at DESC;
# Returns: [User(id=1, name='John'...), User(id=2, name='Jane'...)]
```

#### 4Ô∏è‚É£ Serializer (Data Transformation)

```python
# api/serializers.py
class UserSerializer(serializers.ModelSerializer):
    class Meta:
        model = User
        fields = ['id', 'name', 'email', 'is_active', 'created_at']

# Transforms Python objects to JSON:
# User(id=1, name='John', email='john@...')
# ‚Üì
# {"id": 1, "name": "John", "email": "john@..."}
```

#### 5Ô∏è‚É£ JSON Response

```json
{
  "count": 2,
  "next": null,
  "previous": null,
  "results": [
    {
      "id": 1,
      "name": "John Doe",
      "email": "john@example.com",
      "is_active": true,
      "created_at": "2025-10-15T10:30:00Z"
    },
    {
      "id": 2,
      "name": "Jane Smith",
      "email": "jane@example.com",
      "is_active": true,
      "created_at": "2025-10-14T15:20:00Z"
    }
  ]
}
```

---

## üé® Visual Flow Diagram

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  CLIENT (React/Postman)                    ‚îÇ
‚îÇ              GET http://127.0.0.1:8000/api/users/         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  1. URL ROUTING (blogproject/urls.py)                     ‚îÇ
‚îÇ     path('api/', include('api.urls'))                     ‚îÇ
‚îÇ     ‚Üí Routes to api app                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  2. DRF ROUTER (api/urls.py)                              ‚îÇ
‚îÇ     router.register('users', UserViewSet)                 ‚îÇ
‚îÇ     ‚Üí Maps to UserViewSet.list() method                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  3. VIEW/CONTROLLER (api/views.py)                        ‚îÇ
‚îÇ     class UserViewSet(viewsets.ModelViewSet):             ‚îÇ
‚îÇ         queryset = User.objects.all()  ‚Üê DAL              ‚îÇ
‚îÇ         serializer_class = UserSerializer  ‚Üê DTO          ‚îÇ
‚îÇ                                                            ‚îÇ
‚îÇ     Automatically provides:                                ‚îÇ
‚îÇ     - list()     ‚Üí GET /users/                            ‚îÇ
‚îÇ     - retrieve() ‚Üí GET /users/{id}/                       ‚îÇ
‚îÇ     - create()   ‚Üí POST /users/                           ‚îÇ
‚îÇ     - update()   ‚Üí PUT /users/{id}/                       ‚îÇ
‚îÇ     - destroy()  ‚Üí DELETE /users/{id}/                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  4. MODEL/ORM (api/models.py)                             ‚îÇ
‚îÇ     User.objects.all()                                     ‚îÇ
‚îÇ     ‚Üí SELECT * FROM users ORDER BY created_at DESC;       ‚îÇ
‚îÇ     ‚Üí Returns QuerySet of User objects                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  5. SERIALIZER/DTO (api/serializers.py)                   ‚îÇ
‚îÇ     UserSerializer(users, many=True)                       ‚îÇ
‚îÇ     ‚Üí Converts Python objects to JSON                      ‚îÇ
‚îÇ     ‚Üí Validates data                                       ‚îÇ
‚îÇ     ‚Üí Applies field rules (read_only, required, etc.)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  6. JSON RESPONSE                                          ‚îÇ
‚îÇ     {                                                      ‚îÇ
‚îÇ       "count": 2,                                         ‚îÇ
‚îÇ       "results": [                                        ‚îÇ
‚îÇ         {"id": 1, "name": "John", ...},                  ‚îÇ
‚îÇ         {"id": 2, "name": "Jane", ...}                   ‚îÇ
‚îÇ       ]                                                    ‚îÇ
‚îÇ     }                                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üî• Why ViewSets are Powerful

### Node.js: Lots of Boilerplate (‚âà50 lines)

```javascript
// You have to write ALL of this manually:

router.get('/users', async (req, res) => {
  const users = await prisma.user.findMany();
  res.json(users);
});

router.get('/users/:id', async (req, res) => {
  const user = await prisma.user.findUnique({ where: { id: req.params.id } });
  if (!user) return res.status(404).json({ error: 'Not found' });
  res.json(user);
});

router.post('/users', async (req, res) => {
  const user = await prisma.user.create({ data: req.body });
  res.status(201).json(user);
});

router.put('/users/:id', async (req, res) => {
  const user = await prisma.user.update({
    where: { id: req.params.id },
    data: req.body
  });
  res.json(user);
});

router.delete('/users/:id', async (req, res) => {
  await prisma.user.delete({ where: { id: req.params.id } });
  res.status(204).send();
});
```

### Django REST Framework: Automatic (3 lines)

```python
# All of the above in just 3 lines:

class UserViewSet(viewsets.ModelViewSet):
    queryset = User.objects.all()
    serializer_class = UserSerializer

# Done! üéâ
# - GET /users/
# - GET /users/{id}/
# - POST /users/
# - PUT /users/{id}/
# - PATCH /users/{id}/
# - DELETE /users/{id}/
# All automatically generated!
```

---

## üéØ Summary: Views = Controllers

| Concept | Node.js/Express | Django REST Framework |
|---------|-----------------|----------------------|
| **Controller** | Route handlers in `controller.ts` | **View/ViewSet** in `views.py` |
| **Service** | Business logic in `service.ts` | Built into ViewSet |
| **Repository/DAL** | Database queries in `repository.ts` | `queryset` in ViewSet |
| **DTO** | Custom DTO classes | **Serializer** |
| **Router** | Express Router | DRF Router + `urls.py` |
| **Validation** | Manual (Zod, Joi, etc.) | Built into Serializer |

**In Django: View = Controller + Service + Repository combined!** üöÄ

---

# üèóÔ∏è Multi-Vendor Home Services Platform Architecture

## Real-World Example: Home Services Booking App
(Like Upwork, but specifically for home services - electricians, plumbers, cleaners, etc.)

---

## üéØ When to Create Separate Django Apps

### Decision Tree

```
Should I create a new app?
‚îÇ
‚îú‚îÄ Does it represent a distinct business domain? ‚Üí YES = New App
‚îú‚îÄ Does it have its own models/data? ‚Üí YES = New App  
‚îú‚îÄ Can it be reused in other projects? ‚Üí YES = New App
‚îú‚îÄ Will it grow complex over time? ‚Üí YES = New App
‚îî‚îÄ Is it just 1-2 models with simple logic? ‚Üí NO = Add to existing app
```

---

## üì¶ Recommended App Structure for Home Services Platform

```
home_services_project/          ‚Üê Main project folder
‚îÇ
‚îú‚îÄ‚îÄ manage.py
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ README.md
‚îÇ
‚îú‚îÄ‚îÄ config/                     ‚Üê Project configuration (settings, urls)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ settings/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py            ‚Üê Common settings
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ development.py     ‚Üê Dev settings
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ production.py      ‚Üê Prod settings
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ staging.py
‚îÇ   ‚îú‚îÄ‚îÄ urls.py                ‚Üê Main URL routing with versioning
‚îÇ   ‚îú‚îÄ‚îÄ wsgi.py
‚îÇ   ‚îî‚îÄ‚îÄ asgi.py
‚îÇ
‚îú‚îÄ‚îÄ apps/                       ‚Üê All Django apps here
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ users/                  ‚Üê User management app
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py          (User, Profile, Address)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serializers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ urls.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ permissions.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ managers.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ providers/              ‚Üê Service provider app
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py          (Provider, ProviderProfile, Availability)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serializers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ urls.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ signals.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/               ‚Üê Services catalog app
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py          (Category, Service, ServicePricing)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serializers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ urls.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ filters.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ bookings/               ‚Üê Booking/appointment app
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py          (Booking, BookingStatus, TimeSlot)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serializers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ urls.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks.py           (Celery tasks)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ state_machine.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ reviews/                ‚Üê Reviews and ratings app
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py          (Review, Rating)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serializers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ urls.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ signals.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ payments/               ‚Üê Payment processing app
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py          (Payment, Transaction, Wallet)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serializers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ urls.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ integrations/      (Stripe, PayPal)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ webhooks.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ notifications/          ‚Üê Notification app
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py          (Notification, PushToken)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serializers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ urls.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ channels/          (WebSocket)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ chat/                   ‚Üê Messaging app
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py          (Conversation, Message)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serializers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ urls.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ consumers.py
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ core/                   ‚Üê Shared utilities app
‚îÇ       ‚îú‚îÄ‚îÄ models.py          (Abstract base models)
‚îÇ       ‚îú‚îÄ‚îÄ permissions.py
‚îÇ       ‚îú‚îÄ‚îÄ pagination.py
‚îÇ       ‚îú‚îÄ‚îÄ exceptions.py
‚îÇ       ‚îî‚îÄ‚îÄ utils.py
‚îÇ
‚îú‚îÄ‚îÄ static/                     ‚Üê Static files
‚îú‚îÄ‚îÄ media/                      ‚Üê User uploaded files
‚îî‚îÄ‚îÄ logs/                       ‚Üê Application logs
```

---

## üéØ Why This Many Apps? (Decision Breakdown)

| App | Why Separate? | Models | Reusable? |
|-----|---------------|--------|-----------|
| **users** | Core authentication, used everywhere | User, Profile, Address | ‚úÖ Yes (any project) |
| **providers** | Distinct business domain, complex logic | Provider, Availability, Documents | ‚úÖ Yes (gig platforms) |
| **services** | Service catalog management | Category, Service, Pricing | ‚úÖ Yes (marketplaces) |
| **bookings** | Core business logic, complex state machine | Booking, TimeSlot, Status | ‚úÖ Yes (appointment apps) |
| **reviews** | Independent feature, can be reused | Review, Rating | ‚úÖ Yes (any marketplace) |
| **payments** | Complex integrations, security critical | Payment, Transaction, Wallet | ‚úÖ Yes (e-commerce) |
| **notifications** | Independent service, multiple channels | Notification, PushToken | ‚úÖ Yes (any app) |
| **chat** | Real-time feature, WebSocket | Conversation, Message | ‚úÖ Yes (social apps) |
| **core** | Shared utilities across apps | Abstract models, helpers | ‚úÖ Yes (framework) |

---

## üî¢ API Versioning Structure (`/api/v1/`)

### Main `config/urls.py` with Versioning

```python
# config/urls.py (Main project URLs with versioning)

from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    # Admin panel
    path('admin/', admin.site.urls),
    
    # API Version 1 (Current stable version)
    path('api/v1/', include([
        path('users/', include('apps.users.urls')),
        path('providers/', include('apps.providers.urls')),
        path('services/', include('apps.services.urls')),
        path('bookings/', include('apps.bookings.urls')),
        path('reviews/', include('apps.reviews.urls')),
        path('payments/', include('apps.payments.urls')),
        path('notifications/', include('apps.notifications.urls')),
        path('chat/', include('apps.chat.urls')),
    ])),
    
    # API Version 2 (Beta - new features)
    # path('api/v2/', include([
    #     path('users/', include('apps.users.urls_v2')),
    #     path('bookings/', include('apps.bookings.urls_v2')),
    #     # Only changed endpoints in v2
    # ])),
    
    # Health check endpoint (no versioning)
    path('health/', include('apps.core.urls')),
]

# Serve media files in development
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

### Resulting URL Structure

```
USERS:
POST   /api/v1/users/register/
POST   /api/v1/users/login/
GET    /api/v1/users/me/
PUT    /api/v1/users/me/
POST   /api/v1/users/change-password/

PROVIDERS:
GET    /api/v1/providers/
GET    /api/v1/providers/{id}/
POST   /api/v1/providers/register/
GET    /api/v1/providers/{id}/services/
GET    /api/v1/providers/{id}/reviews/
GET    /api/v1/providers/{id}/availability/

SERVICES:
GET    /api/v1/services/
GET    /api/v1/services/{id}/
GET    /api/v1/services/categories/
GET    /api/v1/services/search/?category=plumbing&location=NYC

BOOKINGS:
GET    /api/v1/bookings/
POST   /api/v1/bookings/
GET    /api/v1/bookings/{id}/
PATCH  /api/v1/bookings/{id}/cancel/
PATCH  /api/v1/bookings/{id}/accept/
PATCH  /api/v1/bookings/{id}/complete/

REVIEWS:
GET    /api/v1/reviews/
POST   /api/v1/reviews/
GET    /api/v1/reviews/{id}/

PAYMENTS:
POST   /api/v1/payments/create-intent/
POST   /api/v1/payments/confirm/
GET    /api/v1/payments/history/
POST   /api/v1/payments/webhook/

NOTIFICATIONS:
GET    /api/v1/notifications/
PATCH  /api/v1/notifications/{id}/read/

CHAT:
GET    /api/v1/chat/conversations/
POST   /api/v1/chat/conversations/
GET    /api/v1/chat/conversations/{id}/messages/
POST   /api/v1/chat/conversations/{id}/messages/
```

---

## üì± Complete Booking Flow (How Apps Work Together)

### Models from Different Apps

```python
# -----------------------------
# 1. USERS APP
# -----------------------------
class User(AbstractUser):
    """Extended user model"""
    USER_TYPE_CHOICES = [
        ('customer', 'Customer'),
        ('provider', 'Service Provider'),
    ]
    user_type = models.CharField(max_length=20, choices=USER_TYPE_CHOICES)
    phone = models.CharField(max_length=20, blank=True)
    profile_picture = models.ImageField(upload_to='profiles/', null=True)
    is_verified = models.BooleanField(default=False)


class Address(models.Model):
    """User addresses"""
    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='addresses')
    street = models.CharField(max_length=255)
    city = models.CharField(max_length=100)
    state = models.CharField(max_length=100)
    zip_code = models.CharField(max_length=20)
    is_default = models.BooleanField(default=False)


# -----------------------------
# 2. PROVIDERS APP
# -----------------------------
class Provider(models.Model):
    """Service provider profile"""
    user = models.OneToOneField('users.User', on_delete=models.CASCADE)
    business_name = models.CharField(max_length=200)
    description = models.TextField()
    experience_years = models.IntegerField(default=0)
    hourly_rate = models.DecimalField(max_digits=10, decimal_places=2)
    is_available = models.BooleanField(default=True)
    average_rating = models.DecimalField(max_digits=3, decimal_places=2, default=0)
    total_bookings = models.IntegerField(default=0)
    is_verified = models.BooleanField(default=False)


# -----------------------------
# 3. SERVICES APP
# -----------------------------
class ServiceCategory(models.Model):
    """Service categories (Plumbing, Electrical, etc.)"""
    name = models.CharField(max_length=100, unique=True)
    slug = models.SlugField(unique=True)
    icon = models.ImageField(upload_to='categories/', null=True)
    is_active = models.BooleanField(default=True)


class Service(models.Model):
    """Individual services offered"""
    provider = models.ForeignKey('providers.Provider', on_delete=models.CASCADE)
    category = models.ForeignKey(ServiceCategory, on_delete=models.PROTECT)
    name = models.CharField(max_length=200)
    description = models.TextField()
    base_price = models.DecimalField(max_digits=10, decimal_places=2)
    duration_minutes = models.IntegerField()


# -----------------------------
# 4. BOOKINGS APP
# -----------------------------
class Booking(models.Model):
    """Service booking/appointment"""
    STATUS_CHOICES = [
        ('pending', 'Pending'),
        ('accepted', 'Accepted'),
        ('in_progress', 'In Progress'),
        ('completed', 'Completed'),
        ('cancelled', 'Cancelled'),
        ('refunded', 'Refunded'),
    ]
    
    booking_number = models.CharField(max_length=20, unique=True)
    customer = models.ForeignKey('users.User', on_delete=models.PROTECT)
    provider = models.ForeignKey('providers.Provider', on_delete=models.PROTECT)
    service = models.ForeignKey('services.Service', on_delete=models.PROTECT)
    address = models.ForeignKey('users.Address', on_delete=models.PROTECT)
    
    scheduled_date = models.DateField()
    scheduled_time = models.TimeField()
    status = models.CharField(max_length=20, choices=STATUS_CHOICES)
    
    service_fee = models.DecimalField(max_digits=10, decimal_places=2)
    platform_fee = models.DecimalField(max_digits=10, decimal_places=2)
    total_amount = models.DecimalField(max_digits=10, decimal_places=2)


# -----------------------------
# 5. REVIEWS APP
# -----------------------------
class Review(models.Model):
    """Customer reviews for providers"""
    booking = models.OneToOneField('bookings.Booking', on_delete=models.CASCADE)
    customer = models.ForeignKey('users.User', on_delete=models.CASCADE)
    provider = models.ForeignKey('providers.Provider', on_delete=models.CASCADE)
    
    rating = models.IntegerField(choices=[(i, i) for i in range(1, 6)])
    comment = models.TextField()
    professionalism = models.IntegerField(choices=[(i, i) for i in range(1, 6)])
    punctuality = models.IntegerField(choices=[(i, i) for i in range(1, 6)])
    quality = models.IntegerField(choices=[(i, i) for i in range(1, 6)])


# -----------------------------
# 6. PAYMENTS APP
# -----------------------------
class Payment(models.Model):
    """Payment transactions"""
    STATUS_CHOICES = [
        ('pending', 'Pending'),
        ('processing', 'Processing'),
        ('completed', 'Completed'),
        ('failed', 'Failed'),
        ('refunded', 'Refunded'),
    ]
    
    booking = models.ForeignKey('bookings.Booking', on_delete=models.PROTECT)
    customer = models.ForeignKey('users.User', on_delete=models.PROTECT)
    amount = models.DecimalField(max_digits=10, decimal_places=2)
    payment_method = models.CharField(max_length=20)
    status = models.CharField(max_length=20, choices=STATUS_CHOICES)
    transaction_id = models.CharField(max_length=100, unique=True)


# -----------------------------
# 7. NOTIFICATIONS APP
# -----------------------------
class Notification(models.Model):
    """User notifications"""
    user = models.ForeignKey('users.User', on_delete=models.CASCADE)
    notification_type = models.CharField(max_length=50)
    title = models.CharField(max_length=200)
    message = models.TextField()
    is_read = models.BooleanField(default=False)
```

---

## üîÑ Complete Booking Flow

```python
# STEP 1: Customer searches for services
# GET /api/v1/services/?category=plumbing&city=NYC
# ‚Üí services app returns available services

# STEP 2: Customer views provider profile
# GET /api/v1/providers/123/
# ‚Üí providers app returns provider details
# ‚Üí reviews app shows provider ratings

# STEP 3: Customer creates booking
# POST /api/v1/bookings/
# ‚Üí bookings app creates booking
# ‚Üí payments app creates pending payment
# ‚Üí notifications app sends notification to provider

# STEP 4: Provider accepts booking
# PATCH /api/v1/bookings/1/accept/
# ‚Üí bookings app updates status to 'accepted'
# ‚Üí notifications app notifies customer

# STEP 5: Customer makes payment
# POST /api/v1/payments/confirm/
# ‚Üí payments app processes payment via Stripe
# ‚Üí bookings app updates payment status

# STEP 6: Service completed
# PATCH /api/v1/bookings/1/complete/
# ‚Üí bookings app updates status to 'completed'
# ‚Üí payments app releases funds to provider
# ‚Üí notifications app prompts customer to leave review

# STEP 7: Customer leaves review
# POST /api/v1/reviews/
# ‚Üí reviews app creates review
# ‚Üí providers app updates average rating (via signal)
# ‚Üí notifications app notifies provider
```

---

## üéØ Decision Heuristics: When to Create New Apps

### ‚úÖ CREATE NEW APP when:

1. **Distinct Business Domain**
   - users (authentication, profiles)
   - bookings (appointment management)
   - payments (financial transactions)

2. **Independent Functionality**
   - notifications (can work standalone)
   - reviews (can be reused in other projects)
   - chat (independent messaging feature)

3. **Will Grow Complex**
   - providers (verification, availability, ratings, etc.)
   - services (categories, pricing, search, filters)

4. **Reusable Across Projects**
   - core (abstract models, utilities)
   - payments (payment gateway integrations)

5. **Different Team Ownership**
   - Team A works on bookings
   - Team B works on payments

---

### ‚ùå DON'T CREATE NEW APP when:

1. **Too Simple (1-2 models with basic CRUD)**
   - ‚ùå Don't create separate "posts" app for simple blog
   - ‚úÖ Add to existing "content" app

2. **Tightly Coupled to Another App**
   - ‚ùå Don't create "booking_status" app
   - ‚úÖ Keep BookingStatus model in bookings app

3. **No Clear Business Boundary**
   - ‚ùå Don't create "helpers" app
   - ‚úÖ Use core app for utilities

---

## üìä Comparison: Simple vs Complex Projects

### Simple Blog Project (Current)

```
‚ùå Overkill to create separate apps:
   - users app (just User model)
   - posts app (just Post model)

‚úÖ Better approach:
blogproject/
    api/                    ‚Üê Single app is fine
        models.py          (User + Post models)
        serializers.py
        views.py
```

**Why?** Only 2 models, simple relationships, won't grow complex.

---

### Home Services Platform (Complex)

```
‚úÖ Need multiple apps:
home_services/
    users/          ‚Üê Auth + profiles (will grow)
    providers/      ‚Üê Provider management (complex)
    services/       ‚Üê Service catalog (searchable)
    bookings/       ‚Üê Booking workflow (state machine)
    reviews/        ‚Üê Rating system (reusable)
    payments/       ‚Üê Payment processing (3rd party)
    notifications/  ‚Üê Multi-channel notifications
    chat/           ‚Üê Real-time messaging
```

**Why?** Each domain is complex, independent, and will grow over time.

---

## üî¢ API Versioning Best Practices

### When to Use `/api/v1/`

```python
# config/urls.py
urlpatterns = [
    path('api/v1/', include([
        path('bookings/', include('apps.bookings.urls')),
        # ... other apps
    ])),
]
```

### Why Version APIs?

1. **Backward Compatibility**
   ```
   /api/v1/bookings/     ‚Üê Mobile app v1.0 uses this
   /api/v2/bookings/     ‚Üê Mobile app v2.0 uses this (new fields)
   ```

2. **Breaking Changes**
   ```python
   # v1: Booking model
   status = models.CharField(choices=['pending', 'completed'])
   
   # v2: Breaking change (more statuses)
   status = models.CharField(
       choices=['pending', 'accepted', 'in_progress', 'completed']
   )
   ```

3. **Gradual Migration**
   ```
   /api/v1/  ‚Üê Old clients keep working
   /api/v2/  ‚Üê New clients use new features
   ```

---

### Version Migration Strategy

```python
# apps/bookings/urls.py (v1)
from rest_framework.routers import DefaultRouter
from .views import BookingViewSet

router = DefaultRouter()
router.register('', BookingViewSet, basename='booking')
urlpatterns = router.urls


# apps/bookings/urls_v2.py (v2)
from rest_framework.routers import DefaultRouter
from .views_v2 import BookingViewSetV2  # New version

router = DefaultRouter()
router.register('', BookingViewSetV2, basename='booking-v2')
urlpatterns = router.urls


# config/urls.py
urlpatterns = [
    path('api/v1/bookings/', include('apps.bookings.urls')),      # Old
    path('api/v2/bookings/', include('apps.bookings.urls_v2')),   # New
]
```

---

## üìã Quick Decision Matrix

| Scenario | Create New App? | Reasoning |
|----------|-----------------|-----------|
| Blog with Posts & Users | ‚ùå No | Too simple, keep in one `api` app |
| E-commerce (Products, Orders, Payments) | ‚úÖ Yes | 3 distinct domains, will grow complex |
| Social media (Posts, Comments, Likes) | ‚ùå No (initially) | Keep in `posts` app until complex |
| Marketplace (Vendors, Products, Orders, Reviews) | ‚úÖ Yes | Multi-vendor requires separation |
| Booking platform (Services, Bookings, Payments) | ‚úÖ Yes | Complex workflows, integrations |
| Admin dashboard with reports | ‚ùå No | Add to `core` or existing admin |
| Real-time chat | ‚úÖ Yes | Independent feature, WebSocket |
| Email notifications | ‚ùå Maybe | If simple ‚Üí `core`, if complex ‚Üí separate |

---

## üéØ Final Summary

### Your Current Project (Simple Blog)
```
‚úÖ Single `api` app is perfect
   - 2 simple models (User, Post)
   - Basic CRUD operations
   - Won't grow complex
```

### Home Services Platform (Complex)
```
‚úÖ Need 8+ apps
   - users, providers, services, bookings
   - reviews, payments, notifications, chat
   - Each domain is complex and independent
```

### API Versioning
```
‚úÖ Use /api/v1/ from the start
   - Easy to add /api/v2/ later
   - Protects existing clients
   - Allows breaking changes
```

---

## Key Principles

1. **Start simple** - Don't over-engineer early
2. **Refactor when needed** - Split apps as complexity grows
3. **Think reusability** - Can this app work in other projects?
4. **Business boundaries** - Each app should represent a clear domain
5. **Team scalability** - Separate apps allow parallel development
6. **Version from day one** - `/api/v1/` prevents future pain

---

**Remember:** The goal is maintainability and scalability, not just organization!
